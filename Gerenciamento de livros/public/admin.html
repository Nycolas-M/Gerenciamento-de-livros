<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel do Administrador</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
<h1>ðŸ‘‘ Painel de AdministraÃ§Ã£o</h1>
<button id="logout">Sair</button>
</header>


<main>
<section>
<h2>UsuÃ¡rios</h2>
<table>
<thead>
<tr>
<th>ID</th>
<th>UsuÃ¡rio</th>
<th>Tipo</th>
<th>AÃ§Ãµes</th>
</tr>
</thead>
<tbody id="usuarios-list"></tbody>
</table>
</section>
</main>


<script>
const token = localStorage.getItem('token');
if (!token) {
window.location.href = 'login.html';
}


async function carregarUsuarios() {
const res = await fetch('/admin/users', {
headers: { Authorization: `Bearer ${token}` }
});
if (!res.ok) {
alert('Acesso negado. VocÃª nÃ£o Ã© administrador.');
window.location.href = 'index.html';
return;
}
const data = await res.json();
const tbody = document.getElementById('usuarios-list');
tbody.innerHTML = '';
data.forEach(user => {
const tr = document.createElement('tr');
tr.innerHTML = `
<td>${user.id}</td>
<td>${user.username}</td>
<td>${user.role}</td>
<td>
<button onclick="promoverUsuario(${user.id})">Promover</button>
<button onclick="excluirUsuario(${user.id})">Excluir</button>
</td>
`;
tbody.appendChild(tr);
});
}


async function promoverUsuario(id) {
await fetch(`/admin/users/${id}/promote`, {
method: 'PATCH',
headers: { Authorization: `Bearer ${token}` }
});
carregarUsuarios();
}


async function excluirUsuario(id) {
await fetch(`/admin/users/${id}`, {
method: 'DELETE',
headers: { Authorization: `Bearer ${token}` }
});
carregarUsuarios();
}


document.getElementById('logout').addEventListener('click', () => {
localStorage.removeItem('token');
window.location.href = 'login.html';
});

carregarUsuarios();
</script>
</body>
</html>